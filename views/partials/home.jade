div(layout="column", layout-fill)
    md-toolbar.md-primary.fixed
        div(class="md-toolbar-tools")
            h1 Open Image Feed
            span(flex)
            div(ng-if="currentUser") Hello {{ currentUser.username }}
    div(ng-controller="AddPostCtrl")
        md-fab-speed-dial(id="custom-fab-speed",md-direction="down",class="md-hover-full md-scale md-fab-top-right",ng-mouseenter="speedDial.isOpen = true",ng-mouseleave="speedDial.isOpen = false")
            md-fab-trigger
                md-button(aria-label="menu", class="md-fab md-warn")
                    md-icon(md-svg-src="/img/icons/ic_menu_white_48px.svg")
            md-fab-actions
                md-button(class="md-fab md-raised md-mini", aria-label="Refresh", ng-click="updateFeed()")
                    md-icon(md-svg-src="/img/icons/ic_refresh_black_48px.svg")
                    md-tooltip(md-direction="bottom") Refresh feed
                span(flex)
                md-button(class="md-fab md-raised md-mini", aria-label="Add post", ng-click="showAddDialog($event)")
                    md-icon(md-svg-src="/img/icons/ic_add_black_48px.svg")
                    md-tooltip(md-direction="bottom") Add a new post
    div(id="feed-container")
        div(ng-controller="FeedCtrl")
            md-content.md-padding.light-grey-background.card-container
                div(ng-show="showLoading", layout="row", layout-sm="column", layout-align="center center")
                    md-progress-circular(md-mode="indeterminate")
                md-card(ng-repeat="post in feed.posts", ng-controller="PostCtrl")
                    img(ng-src="{{ post.image }}", class="md-card-image", alt="{{ post.title }}")
                    md-card-content
                        h2.md-title {{ post.title }}
                        h3.md-subheader {{ post.author.username }}
                    div.md-actions(layout="row",layout-align="end center")
                        |{{ post.comments.length }}
                        md-button(class="md-icon-button", aria-label="Favorite")
                            md-icon(md-svg-icon="/img/icons/ic_mode_comment_white_48px.svg", ng-click="toggleComments(post)")
                        |{{ post.upvotes.length }}
                        md-button(class="md-icon-button md-primary", aria-label="Settings")
                            md-icon(md-svg-icon="/img/icons/ic_keyboard_arrow_up_white_48px.svg", ng-click="upvote(post)")
                        |{{ post.downvotes.length }}
                        md-button(class="md-icon-button md-warn", aria-label="Favorite")
                           md-icon(md-svg-icon="/img/icons/ic_keyboard_arrow_down_white_48px.svg", ng-click="downvote(post)")
                    md-list(class="list-comments", ng-class=" {'hidden' : !showComments}")
                        md-button(class="md-fab md-warn", aria-label="Add post", ng-click="showAddCommentForm()")
                            md-icon(md-svg-src="/img/icons/ic_add_white_48px.svg")
                            md-tooltip(md-direction="bottom") Add a comment
                        div(ng-show="isCommentsLoading", layout="row", layout-sm="column", layout-align="center center")
                            md-progress-circular(md-mode="indeterminate")
                        form(name="form_comment",ng-submit="addComment(form_comment.$valid)", novalidate, ng-show="showAddComment")
                            md-content(layout-padding)
                                div(layout, layout-sm="row")
                                    md-input-container(ng-class="{ 'has-error' : form_comment.content.$invalid && !form_comment.content.$pristine && form_comment.content.$touched }")
                                        label Comment
                                        input.addCommentInput(type="text",ng-model="newComment.content", name="content", ng-required="true", ng-minlength="2", ng-maxlength="80",columns="1", md-maxlength="80")
                                        div(ng-messages="form_comment.content.$error",ng-show="form_comment.content.$touched")
                                            p(ng-message="required", class="help-block")
                                                | Comment is required
                                            p(ng-message="minlength", class="help-block")
                                                | Comment is too short
                                            p(ng-message="maxlength", class="help-block")
                                                | Comment is too long
                            div(class="md-dialog-actions", layout="row")
                                span(flex)
                                md-button(type="submit", style="margin-right:20px;")
                                    |Add comment
                        md-list-item(class="md-2-line", ng-repeat="comment in post.comments")
                            div.md-list-item-text
                                h3 {{ comment.author.username }}
                                p {{ comment.content }}